# Malware Classification using Deep Learning based Feature Extraction and Wrapper based Feature Selection Technique
使用基于深度学习的特征提取和基于包装器的特征选择技术的恶意软件分类

DLMD（deep learning-based malware detection）

https://github.com/cyberhunters/Malware-Detection-Using-Machine-Learning

## 摘要

提出的DLMD技术使用字节和ASM文件进行特征工程，从而对恶意软件家族进行分类。

（ASM：ASM是汇编语言源程序的扩展名）

首先，使用两种不同的深度卷积神经网络从字节文件中提取特征。

之后，使用基于包装器的机制来选择基本的和有区别的操作码特征，其中支持向量机(SVM)被用作分类器。

MLP 多层感知机，全连接

* SVM用于从ASM文件中选择信息特征空间。

* CNN自动编码器用于从字节文件中提取特征。

* 从提取的和选择的特征空间生成混合特征空间，这有助于克服与不同特征空间相关的不足。

* 恶意软件家族的最终分类使用MLP进行。

## 正文

所提出的DLMD技术检测BIG15恶意软件检测相关数据集中提供的不同恶意软件家族。该数据集包含针对九个不同恶意软件系列的字节和asm文件。因此，提议的DLMD方法使用数据集的字节和asm文件进行要素工程。

* 首先，使用两个深度神经网络从字节文件中提取特征。然而，基于包装的特征选择技术应用于asm文件，目的是选择信息特征[34]。

* 然后，通过组合所有选择和提取的特征来创建混合数据集。

* 最后，利用混合特征空间训练多层感知器，最终对9个不同的恶意软件家族进行分类。提议的DLMD技术的框图如图1所示。

![image-20210719104334535](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719104334535.png)

### CNN

### Autoencoder

* 编码体系结构，用于减少输入数据的维度，主要是在一系列节点减少的层中。

* 数据通过编码架构后的低级表示。

* 解码体系结构，具有一系列层，层的数量大部分增加，导致数据从低级表示投影回原始形式。为了在自动编码器的训练过程中带来泛化能力，在损失函数中加入了L1和L2权重正则项。

### Dataset

用于评估提议的DLMD技术的数据集是微软在Kaggle平台上发布的**BIG  2015**。

这一数据已成为研究人员的基准，并在50多篇论文中被引用[28]。

数据集有0.5tb，包含10868个训练样本和10873个测试样本。到目前为止，没有针对测试样本提供标签，因此本研究仅使用列车数据。

数据集由9个恶意软件家族组成，而不同家族的频率分布分别以图表和表格形式显示在图2和表1中。

数据集中恶意软件分类，不同恶意软件系列相关的描述如下:

Ramnit:它窃取用户凭据，如密码信用卡信息，并停止安全软件。

Lollipop:它是一个在浏览器上显示广告的广告软件；它还允许黑客监控用户流量。

Kelihos  _ ver1和Kelihos _  ver3:木马类型可以完全控制用户pc，并通过从用户pc向其他人发送垃圾邮件来传播。

Vundo:它可能负责弹出广告和安装其他恶意内容。

Simda:这些类型的恶意软件从用户电脑中窃取密码，并为黑客制造后门。

Traceur:利用这种恶意软件攻击，作者通过在搜索引擎上显示虚假广告来创收。

Obfuscator ACY:这些被认为是混淆的恶意软件，它们的目的可能是上面提到的任何恶意软件。

Gatak:这也是一种特洛伊木马，看似合法，但会用其恶意代码感染计算机。



BIG 2015训练数据集中，针对每个恶意软件，提供了两个文件，一个是字节文件，另一个是汇编代码(.asm文件)。

![image-20210719111507419](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719111507419.png)

![image-20210719111520420](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719111520420.png)

 ### ASM file

Asm文件基本上是恶意软件汇编代码，包含与函数调用和变量分配相关的信息。

![image-20210719113359708](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719113359708.png)

每个部分都有自己的操作码类型。由于提出的技术只处理操作码，因此冗余信息从asm文件中删除。

此外，对于每个恶意软件样本，记录针对唯一操作码的术语频率，如下所示:

![image-20210719113954234](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719113954234.png)

### Byte file

字节文件是恶意软件的可移植可执行文件的十六进制表示。文件的每一行都称为一条记录。

在给定的数据集中，它有两个部分：

* 第一个是指令内存地址的偏移量。
* 第二部分是指令本身，用一对六位小数表示。

IDA反汇编工具可以将任何可移植的可执行文件转换成字节文件。这些字节文件是asm文件中存在的汇编指令的直接映射。

字节文件转换成图像，如图4所示。每个十六进制对都被视为单个十进制数，用作图像的像素值。然后将这些图像调整到32x32的标准尺寸。

![image-20210719114130420](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719114130420.png)

### 数据集划分

![image-20210719114408530](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719114408530.png)

### Feature Extraction using CNN 

![image-20210719114642559](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719114642559.png)

第二种类型的特征提取也是通过使用CNN来执行的，以这种方式，使用卷积自动编码器来训练CNN的卷积层。在这方面，最初，在原始字节文件上训练两个卷积自动编码器(CAE)。而第二自动编码器的输入是第一编码器的原始编码数据。在第二阶段，CAE预先训练好的编码层被用作CNN的卷积层，为了微调，它有两个完全连接的层，如图7所示。在微调期间，保存最佳模型状态，验证数据的日志损失最小。在训练之后，所有的数据集(训练、验证和测试)通过最佳模型，以获得针对每个恶意软件样本的九个概率作为特征。

![image-20210719114725743](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719114725743.png)

### Wrapper based Feature selection  

基于包装器的特征选择

在提出的DLMD方法中，使用基于包装器的技术来选择特征，其中具有RBF核的SVM被用作从ASM文件中选择重要操作码的分类器。对于特征选择，使用向前和向后选择方法。它从10个特征开始，递增10  ^  12(正向选择)。在优化每个SVM之后，注意到一旦特征达到120，SVM性能开始下降，因此为了更好的结果，减量1(后向选择)。在所提出的DLMD技术中，使用基于包装器的特征选择技术来选择116个特征。

下图中显示了使用基于包装的技术进行的功能选择

![image-20210719115037196](C:\Users\Z&S\AppData\Roaming\Typora\typora-user-images\image-20210719115037196.png)

### Classification of malware families on the hybrid dataset using MLP

